(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Mm:()=>C,YS:()=>T,vV:()=>E,Ph:()=>L});var t=document.querySelector("input[name='user-name']"),o=document.querySelector("input[name='user-profession']"),n=document.querySelector(".profile__name"),r=document.querySelector(".profile__profession"),a=document.querySelector("input[name='place-name']"),c=document.querySelector("input[name='avatar-link']"),u=document.querySelector("input[name='place-link']");function i(e){e?Array.from(document.querySelectorAll(".form__submit-button")).forEach((function(e){e.value="Сохранение...","add-new-place"==e.parentNode.name&&(e.value="Создание..")})):Array.from(document.querySelectorAll(".form__submit-button")).forEach((function(e){e.value="Сохранить","add-new-place"==e.parentNode.name&&(e.value="Создать")}))}function s(e){var t=document.querySelector(".profile__name"),o=document.querySelector(".profile__profession"),n=document.querySelector(".profile__image");t.textContent=e.name,o.textContent=e.about,n.src=e.avatar}function l(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",p),document.addEventListener("keydown",f)}function d(e){e.classList.remove("popup_opened"),e.removeEventListener("mousedown",p),document.removeEventListener("keydown",f)}function p(e){e.target.classList.contains("popup_opened")&&d(e.target)}function f(e){"Escape"===e.key&&d(document.querySelector(".popup_opened"))}var m=function(e){return e.name===n.textContent},h=document.querySelector("#photo-card-template").content,v=document.querySelector(".photo-cards__elements"),_=document.querySelector(".popup__image"),y=document.querySelector(".popup__caption");function S(e){var t=function(e){var t=h.querySelector(".photo-card").cloneNode(!0),o=t.querySelector(".photo-card__image"),n=t.querySelector(".photo-card__title"),r=t.querySelector(".photo-card__like-button"),a=t.querySelector(".photo-card__likes");o.src=e.link,o.alt=e.name,n.textContent=e.name,e.likes.length>0&&e.likes.some(m)&&r.classList.add("photo-card__like-button_active"),a.textContent=e.likes.length,r.addEventListener("click",(function(t){t.target.classList.contains("photo-card__like-button_active")?(t.target.classList.remove("photo-card__like-button_active"),function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-11/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b(e.likes.length,t)})).catch((function(e){console.log(e)}))}(e._id,a),a.textContent=e.likes.length):(t.target.classList.add("photo-card__like-button_active"),function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-11/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){b(e.likes.length,t)})).catch((function(e){console.log(e)}))}(e._id,a),a.textContent=e.likes.length)}));var c=t.querySelector(".photo-card__delete-button");return e.owner.name===document.querySelector(".profile__name").textContent&&c.classList.add("photo-card__delete-button_active"),c.addEventListener("click",(function(o){var n;t.remove(),n=e._id,fetch("https://nomoreparties.co/v1/plus-cohort-11/cards/".concat(n),{method:"DELETE",headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363","Content-Type":"application/json"}})})),o.addEventListener("click",(function(e){_.src=e.target.src,_.alt=e.target.alt,y.textContent=e.target.alt,l(E)})),t}(e);v.prepend(t)}function b(e,t){t.textContent=e}function q(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(o.inactiveButtonClass),t.setAttribute("disabled",!0))}var g,k=document.querySelector(".page"),L=k.querySelector(".profile-popup"),C=k.querySelector(".add-place-popup"),E=k.querySelector(".image-popup"),j=k.querySelector("form[name='user-info']"),A=k.querySelector("form[name='add-new-place']"),x=k.querySelector(".profile__edit-button"),P=k.querySelector(".profile__add-button"),T=(k.querySelector("button[name='close-profile-popup']"),k.querySelector("button[name='close-add-popup']"),k.querySelector("button[name='close-image-popup']"),k.querySelector(".avatar-popup")),w=k.querySelector("form[name='user-avatar']"),z=k.querySelector(".profile__image-overlay"),O=Array.from(k.querySelectorAll(".popup__close-button"));x.addEventListener("click",(function(){return t.value=n.textContent,o.value=r.textContent,void l(L)})),P.addEventListener("click",(function(){return l(C)})),z.addEventListener("click",(function(){return l(T)})),j.addEventListener("submit",(function(e){e.preventDefault();var n,r,a=t.value,c=e.target.querySelector(".form__submit-button"),u=o.value;i(!0),n=a,r=u,fetch("https://nomoreparties.co/v1/plus-cohort-11/users/me",{method:"PATCH",headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n),about:"".concat(r)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s(e)})).finally((function(){i(!1)})).catch((function(e){console.log(e)})),d(L),c.classList.add("form__submit-button_inactive"),c.setAttribute("disabled",!0)})),A.addEventListener("submit",(function(e){e.preventDefault();var t,o,n=a.value,r=e.target.querySelector(".form__submit-button"),c=u.value;i(!0),t=n,o=c,fetch("https://nomoreparties.co/v1/plus-cohort-11/cards",{method:"POST",headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363","Content-Type":"application/json"},body:JSON.stringify({name:"".concat(t),link:"".concat(o)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){S(e)})).finally((function(){i(!1)})).catch((function(e){console.log(e)})),d(C),e.target.reset(),r.classList.add("form__submit-button_inactive"),r.setAttribute("disabled",!0)})),w.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".form__submit-button"),o=c.value;i(!0),function(e){fetch("https://nomoreparties.co/v1/plus-cohort-11/users/me/avatar",{method:"PATCH",headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363","Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s(e)})).finally((function(){i(!1)})).catch((function(e){console.log(e)}))}(o),d(T),e.target.reset(),t.classList.add("form__submit-button_inactive"),t.setAttribute("disabled",!0)})),O.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return d(t)}))})),fetch("https://nomoreparties.co/v1/plus-cohort-11/users/me",{headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){s(e)})).catch((function(e){console.log(e)})),fetch("https://nomoreparties.co/v1/plus-cohort-11/cards",{headers:{authorization:"d04fa384-542f-4f76-a0e6-73d54ad20363"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){S(e)}))})).catch((function(e){console.log(e)})),g={popupSelector:".popup",formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__submit-button",inactiveButtonClass:"form__submit-button_inactive",inputErrorClass:"form__item_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(g.popupSelector)).forEach((function(e){var t=e.querySelector(g.formSelector);null!==t&&function(e,t,o){var n=Array.from(t.querySelectorAll(o.inputSelector)),r=t.querySelector(o.submitButtonSelector);q(n,r,o),n.forEach((function(e){e.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(t,e,o),q(n,r,o)}))}))}(0,t,g)}))})();